<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Linux vs Lenovo V560 | A5215</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  

  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
  <link rel="stylesheet" href="/hexo-site/css/pure-min.css" type="text/css">
  <link rel="stylesheet" href="/hexo-site/css/biture.css" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

</head>


<body>
  <header id="header">
    <div class="wrap">
  <div class="inner">
    <a class="brand" data-text="A5215" href="/hexo-site/">A5215</a>
    <a id="menu-toggle" href="#"><i class="fa fa-bars"></i></a>
<ul class="nav-menu">


    <li><a href="/">home</a></li>



  <li><a href="#">dropdown menu</a>
    <ul class="sub-menu">

      <li><a href="//google.com/">google</a></li>

      <li><a href="//natribu.org/">second dropdown</a></li>

    </ul>
  </li>


</ul>

<ul class="nav-menu ext-menu">


  <li><a href="#">theme</a>
    <ul class="sub-menu">

      <li><a href="//hexo.io/">hexo</a></li>

      <li><a href="//github.com/kywk/hexo-theme-biture">biture</a></li>

      <li><a href="//github.com/kywk/">kywk</a></li>

    </ul>
  </li>



  <li><a href="#">@</a>
    <ul class="sub-menu">

      <li><a href="//vk.com/max_f_m">VK</a></li>

      <li><a href="404">mail</a></li>

    </ul>
  </li>


  <li><a class="various" href="#fbox-tagcloud">tags</a></li>
</ul>
</div>

  </div>
</div>

<div class="tagcloud" id="fbox-tagcloud" style="margin:10px; display:none; overflow: hidden"><a href="/hexo-site/tags/красноглазие/" style="font-size: NaNpx;">красноглазие</a></div>

  </header>
  <div id="main-content" class="wrap">
  <div class="inner">
    <article class="post">
  <div class="pure-g">

    <!-- article: meta -->
    <div class="pure-u-1-12 article-meta">
      <div class="date"><time datetime="2015-01-07T20:03:41.000Z">
        <div class="day">7</div>
        <div class="month">Jan 2015</div>
      </time></div>
      <div class="article-tags">
        
  
    <a href='/hexo-site/tags/красноглазие/' class='pure-button pull-right' style='margin:3px;'>красноглазие</a>
  


      </div>
    </div>

    <!-- article: main -->
    <div class="pure-u-11-12">
      <header><div class="article-title">
        
  
    <h1 class="title">Linux vs Lenovo V560</h1>
  

      </div></header>
      <div class="article-entry">
        
          <p>Описание способов подружить железо и софт. Железо - ноутбук Lenovo V560. Софт - Linux Mint, версия на момент написания - Rebecca 17.1.</p>
<h1 id="Дискретное_видео">Дискретное видео</h1>
<p>Самое проблемное место этого ноутбука. На данный момент штатных способов подружить Wine и проприетарные драйверы nvidia нет. Если планируется эксперимент с вайном - используй отдельную экспериментальную систему и будь готов к абсурдным по величине затратам времени.</p>
<p>Для установки проприетарного драйвера я делаю вот что:</p>
<p>From Package Manager:</p>
<p>install bumblebee with bbswitch-dkms<br>install primus<br>install bumblebee-nvidia<br>(the Manager will add a few dependecies - accept these as well)</p>
<p>From Driver Manager (accessible through Control Centre)<br>install recommended Nvidia 331 driver</p>
<p>To run software use i.e.:<br>primusrun wine or optirun wine</p>
<p>Settings:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">optirun nvidia-settings -c :<span class="number">8</span></div></pre></td></tr></table></figure>

<p>Проблемы:<br>Failed to open VDPAU backend libvdpau_nvidia.so: невозможно открыть разделяемый объектный файл: Нет такого файла или каталога</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">sudo</span> ln <span class="operator">-s</span>  /usr/lib/nvidia-<span class="number">331</span>/vdpau/libvdpau_nvidia.so.<span class="number">1</span> /usr/lib/libvdpau_nvidia.so</div><div class="line"><span class="built_in">sudo</span> chmod u+s /usr/lib/libvdpau_nvidia.so</div></pre></td></tr></table></figure>

<p>(после обновления дров выполнить sudo rm /usr/lib/libvdpau_nvidia.so и повторить команды выше)</p>
<h1 id="Wine">Wine</h1>
<p>Wine и драйвер nvidia никак не могут поделить одну библиотеку, что приводит к взаимному выпиливанию при установке каждого из них. Костыль - установка левой библиотеки, причём после при повторных установках драйверов или вайна не исключается повторение проблем. Рекомендую поставить всё это дело один раз и не трогать вплоть до появления стабильного решения. Хотя можно не трогать его и дальше, так спокойнее.</p>
<p>Решение:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">sudo</span> apt-get install nvidia-cuda toolkit</div><div class="line"><span class="built_in">sudo</span> apt-get install ocl-icd-opencl-dev (this will remove nvidia-libopencl1-* and nvidia-opencl-dev)</div><div class="line"><span class="built_in">sudo</span> apt-get install wine1.<span class="number">6</span></div></pre></td></tr></table></figure>

<p>This will work around the bug and allows installing Wine without asking for the removal, but it also keeps the file in question at /usr/lib/*/libOpenCL.so</p>
<p>Или другими словами:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">sudo</span> apt-get install nvidia-cuda-toolkit</div><div class="line"><span class="comment">###Need to get 250 MB of archives; 774 MB of additional disk space will be used</span></div><div class="line"><span class="built_in">sudo</span> apt-get install ocl-icd-opencl-dev</div><div class="line"><span class="comment">###this will remove nvidia-libopencl1-* and nvidia-opencl-dev</span></div><div class="line"><span class="built_in">sudo</span> apt-get install wine</div><div class="line"><span class="comment">###Need to get 121 MB; 342 MB of additional disk space will be used.</span></div></pre></td></tr></table></figure>

<p>И ещё для вайна:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">WINEARCH=win32 WINEPREFIX=~/.wine winecfg</div></pre></td></tr></table></figure>

<p>должно сконфигурировать 32хбитный префикс.<br>Для экспериментов предпочтительно использование отдельного префикса:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">WINEPREFIX=<span class="string">'/home/username/prefix32'</span> WINEARCH=<span class="string">'win32'</span> wine <span class="string">'wineboot'</span></div></pre></td></tr></table></figure>

<p>Или поставить PlayOnLinux. </p>
<h1 id="SSD">SSD</h1>
<p>Опции для монтирования твёрдотельных накопителей:<br>relatime - задаёт запрет на изменение времени доступа к файлу (не ранее времени модификации)<br>discard - обеспечивает работу команды TRIM. Внимание! Некоторые SSD до 2010 года выпуска не совместимы с этой опцией. Перед включением проверить на совместимость!<br>SWAP раздел не стоит хранить на SSD по причине его своеобразной реализации и применения. Лучше его помещать на HDD.<br>Дефрагментация: не нужна. Серьёзно. Если кто посоветует - назначить ему дефрагментацию мозга столовыми приборами.</p>
<h1 id="GRUB2">GRUB2</h1>
<p>Конечно я никак не могу обойтись без модификации загрузчика. Ведь зачем ждать 10 секунд, когда достаточно и [напиши сюда цифру]?</p>
<p>Для сохранения выбора последней загруженной системы</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">sudo</span> gedit /etc/default/grub</div></pre></td></tr></table></figure>

<p>изменить строку GRUB_DEFAULT=0 на<br>GRUB_DEFAULT=saved<br>GRUB_SAVEDEFAULT=true<br>и затем выполняем</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">sudo</span> update-grub</div></pre></td></tr></table></figure>

<p>Там же можно изменить и ожидание выбора.</p>
<h1 id="Датчик_отпечатков_пальцев">Датчик отпечатков пальцев</h1>
<p>Да, здесь есть и такое. Реализация кривая что на линуксе, что на винде. Однако, для винды существует стабильный проприетарный софт, а для линукса - как всегда, нечто красноглазое. Так как инструкции я писал урывками, то здесь всё будет выложено так, как у меня на диске.<br>Основные моменты разработки можно найти здесь:<br><a href="https://www.libreoffice.org/bugzilla/show_bug.cgi?id=73762" target="_blank" rel="external">https://www.libreoffice.org/bugzilla/show_bug.cgi?id=73762</a>.</p>
<p>Зависимости (видимо, при компиляции пофиксенного драйвера)<br>libtoolize - libtool<br>aclocal - automake<br>libusb-1.0 - libusb-1.0-0-dev<br>nss - libcurl4-nss-dev<br>glib-2.0 - libglib2.0-dev<br>pixman - libpixman-1-dev<br>XV - imagemagick? libxv-dev!<br>—enable-maintainer-mode - удалить<br>g++ - g++</p>
<p>libfprint-0.3.0-r1.tar.bz2 содержит экспериментальный драйвер, работающий на Lenovo v560 и Gentoo.</p>
<p>if you want to use fprint_demo with fingerprint gui<br>sudo chmod a+rw /dev/bus/usb/002/003<br>Сие может варьироваться. Нужно уточнять!</p>
<p>На данный момент у меня есть Libfprint_Patched_Egistec_0.5.1-1_amd64.deb - пакетик, который я уже точно проверил на Ubuntu Mate.<br>У подопытного наблюдались следующие симптомы: в некоторых случаях окно ввода пароля/пальца отсутствует, что может сбить с толку, так как ввод всё равно читается. Качество считывания такое, что полученный отпечаток необходимо тщательно проверять: если его нельзя повторить с тем же пальцем в разных положениях и скоростях, то он бесполезен, а если этот же отпечаток положительно реагирует на другие пальцы, то он бесполезен вдвойне.</p>
<h1 id="Сеть">Сеть</h1>
<p>Здесь тоже проблемы. Для начала - неприятный баг в драйвере atl1c, внезапно выдающем из ниоткуда плотный поток данных в статистике. Это не только ломает график, но и переполняет счётчик пакетов, что не позволяет выполнить ни одно новое подключение. Решение пока одно: отключать драйвер в случае проблем. Если же он нужен, то его можно загрузить так же быстро, как и выгрузить.<br>Инструкции:</p>
<p>Problem with eth0 statistics: increasing counters with no data.<br>Solve: DO NOT USE atl1c.</p>
<p>zero counters:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">sudo</span> rmmod atl1c (or <span class="built_in">sudo</span> modprobe -r atl1c)</div><div class="line"><span class="built_in">sudo</span> modprobe atl1c</div></pre></td></tr></table></figure>

<p>blacklist atl1c:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">sudo</span> gedit /etc/modprobe.d/blacklist.conf</div></pre></td></tr></table></figure>

<p>add line:<br>blacklist atl1c</p>
<p>If you need wired connection:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">sudo</span> modprobe atl1c</div></pre></td></tr></table></figure>

<p>Ещё проблема: драйвер беспроводной связи для BCM4313 странно себя ведёт с ривером и прочими подобными штуками. Точки - видит. Пользователей - тоже. Но вмешиваться в трафик - ни-ни! Ломануть по WPS он не может, как ни пытайся. Ну разве что ты будешь ломать с заранее известным паролем… Это как взлом двери ключом от неё. Решение мне искать уже лень, так как драйверы - штука нестабильная и скучная. Мне и Nvidia Optimus хватило.</p>
<h1 id="МФУ">МФУ</h1>
<p>Напоследок ещё одно решение, хотя это уже оффтоп: драйвер для МФУ. Удивительно, но на него драйверы лежат в свободном доступе здесь:<br><a href="http://www.canon.ru/Support/Consumer_Products/products/Fax__Multifunctionals/Laser/LaserBase_MF_series/i-SENSYS_MF4010.aspx?type=download&amp;softwaredetailid=tcm:203-1135803&amp;os=&amp;language=" target="_blank" rel="external">http://www.canon.ru/Support/Consumer_Products/products/Fax__Multifunctionals/Laser/LaserBase_MF_series/i-SENSYS_MF4010.aspx?type=download&amp;softwaredetailid=tcm:203-1135803&amp;os=&amp;language=</a></p>

        
      </div>
      <footer><div class="article-comment">
        
<section id="comment">
  <h1 class="title">comment</h1>

  
</section>


      </div></footer>
    </div>
  </div>
</article>

  </div>
  </div>
  <footer id="footer">
    <div class="wrap">
  <div class="inner" style="text-align: center">
    
    &copy; 2015 Avis5215 All Rights Reserved
    

    / <a href="https://github.com/kywk/hexo-theme-biture">biture</a> for <a href="http://zespia.tw/hexo/">hexo</a>
    / developed by <a href="http://kywk.github.io/moco/">MooCow (kywk)</a>.
  </div>
</div>

  </footer>
<!-- Le javascript -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>


<!-- Responsive menu -->
<script>
$(document).ready(function() {
  $("#menu-toggle").click(function(event) {
    event.preventDefault();
    if ($(this).hasClass("isShow")) {
      $("#header").css({position: "fixed"});
      $("ul.nav-menu").hide();
      $(this).removeClass("isShow");
    } else {
      $("#header").css({position: "static"});
      $("ul.nav-menu").show();
      $("html, body").scrollTop(0);
      $(this).addClass("isShow");
    }
    return false;
  });

  $(window).resize(function() {
    if ($(window).width() > 700) {
      $("ul.nav-menu").removeAttr('style');
    }
  });

});
</script>






<link rel="stylesheet" href="/hexo-site/package/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="/hexo-site/package/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<script type="text/javascript">
(function($){
  $(".fancybox").fancybox();
  $(".various").fancybox({
    maxWidth  : 800,
    maxHeight : 600,
    fitToView : false,
    width   : '70%',
    height    : '70%',
    autoSize  : true,
    closeClick  : false,
    openEffect  : 'none',
    closeEffect : 'none'
  });
})(jQuery);
</script>


</body>
</html>
